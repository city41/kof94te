{
  "description": "Go to new routine after HTP instead of team select",
  "subroutineSpace": {
    "start": "97000",
    "end": "bfff0"
  },
  "symbols": {
    "CHAR_SELECT_COUNTER": "10f7fe",
    "IN_CHAR_SELECT_FLAG": "10f800",
    "P1_CURSOR_X": "10f802",
    "P1_CURSOR_Y": "10f804",
    "STORE_A0": "10f806",
    "STORE_A1": "10f816",
    "GRID_IMAGE_SI": "14a",
    "P1_CURSOR_BLACK_BORDER_SI": "15e",
    "P1_CURSOR_WHITE_BORDER_SI": "162"
  },
  "patches": [
    {
      "type": "prom",
      "description": "avatar tile table",
      "subroutine": true,
      "symbol": "AVATAR_TILE_TABLE",
      "patchAsm": "avatarTileTable.asm"
    },
    {
      "type": "prom",
      "description": "palettes",
      "subroutine": true,
      "symbol": "PALETTES",
      "patchAsm": "palettes.asm"
    },
    {
      "type": "prom",
      "description": "character_grid image",
      "subroutine": true,
      "symbol": "CHARACTER_GRID_IMAGE",
      "patchAsm": "character_grid.asm"
    },
    {
      "type": "prom",
      "description": "p1 cursor, black border, image",
      "subroutine": true,
      "symbol": "P1_CURSOR_BLACK_BORDER_IMAGE",
      "patchAsm": "p1Cursor_blackBorder.asm"
    },
    {
      "type": "prom",
      "description": "p1 cursor, white border, image",
      "subroutine": true,
      "symbol": "P1_CURSOR_WHITE_BORDER_IMAGE",
      "patchAsm": "p1Cursor_whiteBorder.asm"
    },
    {
      "type": "prom",
      "description": "load palettes routine",
      "subroutine": true,
      "symbol": "LOAD_P_A_L_E_T_T_E_S",
      "patchAsm": "loadPalettes.asm"
    },
    {
      "type": "prom",
      "description": "render static image routine",
      "subroutine": true,
      "symbol": "RENDER_STATIC_IMAGE",
      "patchAsm": "renderStaticImage.asm"
    },
    {
      "type": "prom",
      "description": "move sprite routine",
      "subroutine": true,
      "symbol": "MOVE_SPRITE",
      "patchAsm": "moveSprite.asm"
    },
    {
      "type": "prom",
      "description": "move cursor routine",
      "subroutine": true,
      "symbol": "MOVE_CURSOR",
      "patchAsm": "moveCursor.asm"
    },
    {
      "type": "prom",
      "description": "truncate sprites routine",
      "subroutine": true,
      "symbol": "TRUNCATE_SPRITES_ROUTINE",
      "patchAsm": "truncateSpritesRoutine.asm"
    },
    {
      "type": "prom",
      "description": "teardown routine",
      "subroutine": true,
      "symbol": "CHAR_SELECT_TEARDOWN_ROUTINE",
      "patchAsm": "charSelectTeardownRoutine_runBoth.asm"
    },
    {
      "type": "prom",
      "description": "main routine",
      "subroutine": true,
      "symbol": "CHAR_SELECT_MAIN_ROUTINE",
      "patchAsm": "charSelectMainRoutine_runBoth.asm"
    },
    {
      "type": "prom",
      "description": "init routine",
      "subroutine": true,
      "symbol": "CHAR_SELECT_INIT_ROUTINE",
      "patchAsm": "charSelectInitRoutine_runBoth.asm"
    },
    {
      "type": "prom",
      "descrition": "jump to char init after team init is done",
      "address": "13703c",
      "subroutine": true,
      "patchAsm": [
        "jsr $2CHAR_SELECT_INIT_ROUTINE",
        "move.l #$37046, $108584",
        "rts"
      ]
    },
    {
      "type": "prom",
      "description": "clean up straggling word",
      "address": "137042",
      "patchAsm": ["nop"]
    },
    {
      "type": "prom",
      "description": "skip the sprite clearing block",
      "address": "13369c",
      "subroutine": true,
      "patchAsm": [
        ";;; restore what was clobbered",
        "lea $336a6, A2",
        "adda.w D1, A2",
        ";;; end restore what was clobbered",
        "move.b $IN_CHAR_SELECT_FLAG, D5",
        "cmpi.b #1, D5",
        "bne done",
        "lea $337a6, A2 ; skip all sprite clears",
        "done:",
        "rts"
      ]
    },
    {
      "type": "prom",
      "description": "remove adda as it is now in the subroutine",
      "address": "1336a2",
      "patchAsm": ["nop"]
    },
    {
      "type": "prom",
      "description": "skip the sprite clearing block",
      "address": "1337cc",
      "subroutine": true,
      "patchAsm": [
        ";;; restore what was clobbered",
        "lea $337d6, A2",
        "adda.w D1, A2",
        ";;; end restore what was clobbered",
        "move.b $IN_CHAR_SELECT_FLAG, D5",
        "cmpi.b #1, D5",
        "bne done",
        "lea $338d6, A2 ; skip all sprite clears",
        "done:",
        "rts"
      ]
    },
    {
      "type": "prom",
      "description": "remove adda as it is now in the subroutine",
      "address": "1337d2",
      "patchAsm": ["nop"]
    },
    {
      "type": "prom",
      "description": "skip the sprite clearing block",
      "address": "133a28",
      "subroutine": true,
      "patchAsm": [
        ";;; restore what was clobbered",
        "lea $33a32, A0",
        "adda.w D2, A0",
        ";;; end restore what was clobbered",
        "move.b $IN_CHAR_SELECT_FLAG, D5",
        "cmpi.b #1, D5",
        "bne done",
        "lea $33b32, A0 ; skip all sprite clears",
        "done:",
        "rts"
      ]
    },
    {
      "type": "prom",
      "description": "remove adda as it is now in the subroutine",
      "address": "133a2e",
      "patchAsm": ["nop"]
    },
    {
      "skip": true,
      "type": "prom",
      "description": "skip team select counter decrement",
      "address": "13705a",
      "patchAsm": ["subq.b #0, $655(a5)"]
    },
    {
      "type": "prom",
      "description": "Run char select after team select",
      "address": "137074",
      "subroutine": true,
      "patchAsm": [
        "jsr $2CHAR_SELECT_MAIN_ROUTINE",
        ";;; ;restore what got clobbered",
        "move.b #$3c, $655(A5)",
        "rts"
      ]
    },
    {
      "type": "prom",
      "description": "run teardown just before going to order select",
      "address": "137116",
      "subroutine": true,
      "patchAsm": [
        ";;; restore what was clobbered",
        "move.l #$37eb2, $584(A5)",
        ";;; end restore",
        "jsr $2CHAR_SELECT_TEARDOWN_ROUTINE",
        "rts"
      ]
    },
    {
      "type": "prom",
      "description": "clean up straggling word",
      "address": "13711c",
      "patchAsm": ["nop"]
    },
    {
      "type": "prom",
      "description": "set kyo in membdisp",
      "address": "1379d2",
      "subroutine": true,
      "patchAsm": [
        ";; a4 will point to all six characters in turn",
        "move.b #6, $71(A4)",
        "rts"
      ]
    },
    {
      "type": "prom",
      "description": "load palettes just after vblank",
      "address": "132be4",
      "subroutine": true,
      "patchAsm": [
        ";;; replace what was clobbered",
        "jsr $6536",
        ";;; end replace",
        "move.b $IN_CHAR_SELECT_FLAG, D5",
        "cmpi.b #1, D5",
        "bne skipLoadPalettes",
        "jsr $2LOAD_P_A_L_E_T_T_E_S",
        "skipLoadPalettes:",
        "rts"
      ]
    }
  ]
}
